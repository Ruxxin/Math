<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casio fx-300ES Plus Emulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.js"></script>
    
    <style>
        :root {
            --casio-body: #3d454d;
            --casio-screen: #9eb29d;
            --btn-num: #ececec;
            --btn-func: #2e3133;
            --btn-orange: #f39c12;
        }

        body { 
            background: #f0f0f0; 
            display: flex; 
            justify-content: center; 
            padding-top: 50px;
            font-family: sans-serif;
        }

        #calculator {
            background: var(--casio-body);
            width: 360px;
            padding: 25px;
            border-radius: 20px 20px 50px 50px;
            box-shadow: 0 20px 0 #2c3135;
        }

        /* The LCD Screen */
        #screen {
            background: var(--casio-screen);
            height: 100px;
            border-radius: 5px;
            border: 4px solid #222;
            padding: 10px;
            display: flex;
            flex-direction: column;
            margin-bottom: 25px;
        }

        /* MathQuill Input Field styling */
        #math-field {
            width: 100%;
            border: none !important;
            background: transparent !important;
            font-size: 1.4rem !important;
            color: #1a1a1a;
            box-shadow: none !important;
            height: 60px;
        }

        #result-display {
            text-align: right;
            font-size: 1.4rem;
            font-weight: bold;
            flex-grow: 1;
            padding-top: 5px;
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        button {
            height: 35px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: 0 3px #1a1a1a;
        }

        button:active { transform: translateY(2px); box-shadow: 0 1px #1a1a1a; }

        .num { background: var(--btn-num); color: #000; font-size: 1.1rem; }
        .func { background: var(--btn-func); color: #fff; }
        .orange { background: var(--btn-orange); color: #fff; }

        /* Fraction Button Specific styling */
        .frac-btn-icon {
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body>

<div id="calculator">
    <div id="screen">
        <div id="math-field"></div>
        <div id="result-display">0</div>
    </div>

    <div class="keypad">
        <button class="func" onclick="writeMath('\\frac{}{}')">■/□</button>
        <button class="func" onclick="writeMath('^{}')">xⁿ</button>
        <button class="func" onclick="writeMath('\\sqrt{}')">√</button>
        <button class="func" onclick="cmd('\\log')">log</button>
        <button class="func" onclick="cmd('\\ln')">ln</button>

        <button class="func" onclick="cmd('(')">(</button>
        <button class="func" onclick="cmd(')')">)</button>
        <button class="func" onclick="writeMath('^{-1}')">x⁻¹</button>
        <button class="func" onclick="cmd('\\sin')">sin</button>
        <button class="func" onclick="cmd('\\cos')">cos</button>

        <button class="num" onclick="cmd('7')">7</button>
        <button class="num" onclick="cmd('8')">8</button>
        <button class="num" onclick="cmd('9')">9</button>
        <button class="orange" onclick="del()">DEL</button>
        <button class="orange" onclick="reset()">AC</button>

        <button class="num" onclick="cmd('4')">4</button>
        <button class="num" onclick="cmd('5')">5</button>
        <button class="num" onclick="cmd('6')">6</button>
        <button class="func" onclick="cmd('*')">×</button>
        <button class="func" onclick="cmd('/')">÷</button>

        <button class="num" onclick="cmd('1')">1</button>
        <button class="num" onclick="cmd('2')">2</button>
        <button class="num" onclick="cmd('3')">3</button>
        <button class="func" onclick="cmd('+')">+</button>
        <button class="func" onclick="cmd('-')">−</button>

        <button class="num" onclick="cmd('0')">0</button>
        <button class="num" onclick="cmd('.')">.</button>
        <button class="num" onclick="cmd('\\pi')">π</button>
        <button class="num" onclick="calculate()">=</button>
        <button class="func" onclick="writeMath('\\times10^{}')">exp</button>
    </div>
</div>

<script>
    var MQ = MathQuill.getInterface(2);
    var mathFieldSpan = document.getElementById('math-field');
    var resultDisplay = document.getElementById('result-display');

    var mathField = MQ.MathField(mathFieldSpan, {
        spaceBehavesLikeTab: true,
        handlers: {
            edit: function() {
                // Optional: Auto-calculate on change
            }
        }
    });

    function cmd(char) {
        mathField.cmd(char);
        mathField.focus();
    }

    function writeMath(latex) {
        mathField.write(latex);
        mathField.focus();
    }

    function del() {
        mathField.keystroke('Backspace');
    }

    function reset() {
        mathField.latex('');
        resultDisplay.innerText = '0';
    }

    function calculate() {
        // Get LaTeX from MathQuill and convert to JS-executable math
        let latex = mathField.latex();
        
        // Basic LaTeX to JS conversion logic
        let clean = latex
            .replace(/\\frac{([^}]*)}{([^}]*)}/g, "($1/$2)")
            .replace(/\\left\(/g, "(")
            .replace(/\\right\)/g, ")")
            .replace(/\^{([^}]*)}/g, "**($1)")
            .replace(/\\sqrt{([^}]*)}/g, "Math.sqrt($1)")
            .replace(/\\log/g, "Math.log10")
            .replace(/\\ln/g, "Math.log")
            .replace(/\\pi/g, "Math.PI")
            .replace(/\\times/g, "*");

        try {
            // Using a Function constructor instead of eval for slightly better safety
            let result = Function('"use strict";return (' + clean + ')')();
            
            // Format for Business: 4 decimal places unless it's a whole number
            if (!Number.isInteger(result)) {
                result = Number(result.toFixed(6)); 
            }
            resultDisplay.innerText = result;
        } catch (e) {
            resultDisplay.innerText = "Error";
        }
    }
</script>

</body>
</html>
